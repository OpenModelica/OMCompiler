#!/usr/bin/env python

start = 0
end = 20

print '/* autogenerated by meta_modelica_gen_mk_box.py */'
print ''
print '/* non-atomic boxes, i.e. they contain pointers */'
print ''
for i in range(start,end+1):
  print 'static inline void *mmc_mk_box%d(unsigned int ctor' % i +''.join([', void *x%d' % j for j in range(0,i)]) + ')'
  print '{'
  if i == 0:
    print '  struct mmc_struct *p = (struct mmc_struct *) mmc_alloc_words_atomic(%d);' % (i+1)
  if i > 0:
    print '  struct mmc_struct *p = (struct mmc_struct *) mmc_alloc_words(%d);' % (i+1)
  if i > 0:
    print '  void **data = p->data;'
  print '  p->header = MMC_STRUCTHDR(%d, ctor);' % i
  for j in range(0,i):
    print '  data[%d] = (void*) x%d;' % (j,j)
  print '  return MMC_TAGPTR(p);'
  print '}'
  print ''

print ''
print '/* atomic boxes, i.e. they do not contain pointers */'
print ''
for i in range(start,end+1):
  print 'static inline void *mmc_mk_box%d_atomic(unsigned int ctor' % i +''.join([', void *x%d' % j for j in range(0,i)]) + ')'
  print '{'
  print '  struct mmc_struct *p = (struct mmc_struct *) mmc_alloc_words_atomic(%d);' % (i+1)
  if i > 0:
    print '  void **data = p->data;'
  print '  p->header = MMC_STRUCTHDR(%d, ctor);' % i
  for j in range(0,i):
    print '  data[%d] = (void*) x%d;' % (j,j)
  print '  return MMC_TAGPTR(p);'
  print '}'
  print ''
